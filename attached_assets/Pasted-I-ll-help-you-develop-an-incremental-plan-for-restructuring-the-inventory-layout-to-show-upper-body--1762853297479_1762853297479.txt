I'll help you develop an incremental plan for restructuring the inventory layout to show upper body, lower body, and backpack grids in a unified, collapsible area.

Analysis of Current State
Looking at your codebase:

Current Structure:

BackpackGrid.tsx - Shows equipped backpack container with collapse functionality
InventoryExtensionWindow.tsx - Shows upper/lower body equipment slots and their pocket grids
Equipment slots are separate from the container grids
Your Goals:

Move upper/lower body pocket grids from extension window to main inventory panel
Create unified scrollable area with 3 sections: Upper Body → Lower Body → Backpack
Each section independently collapsible
When no backpack equipped, show "Backpack (none)" instead of message
Each clothing item's pockets appear separately but collapse together
Incremental Implementation Plan
Phase 6A: Refactor BackpackGrid into ClothingContainerPanel (Foundation)
Goal: Create a reusable component for displaying clothing/backpack containers with collapse functionality.

Implementation:

Create ClothingContainerPanel.tsx - Generic collapsible container display component
Props: title, containerId, isCollapsed, onToggle, emptyMessage
Move collapse logic from BackpackGrid.tsx into this component
Keep existing BackpackGrid.tsx for now, just refactor internals to use new component
Acceptance:

Backpack still works exactly as before
Code is cleaner and reusable
No visual changes yet
Phase 6B: Create UnifiedClothingPanel Component (Layout Structure)
Goal: Build the 3-section layout container that will replace BackpackGrid.tsx.

Implementation:

Create UnifiedClothingPanel.tsx with three sections:
- UpperBodySection (collapsible)
- LowerBodySection (collapsible) 
- BackpackSection (collapsible)
Each section uses ClothingContainerPanel from 6A
Implement scroll container wrapping all three sections
Add independent collapse state for each section
Wire to useInventory() to get equipped items
File Structure:

<div className="w-1/2 flex flex-col overflow-hidden">
  {/* Upper Body Section */}
  <ClothingContainerPanel 
    title="Upper Body"
    equippedItem={equipment.upper_body}
    pocketContainers={upperBodyPockets}
    isCollapsed={upperCollapsed}
    onToggle={() => setUpperCollapsed(!upperCollapsed)}
  />
  
  {/* Lower Body Section */}
  <ClothingContainerPanel 
    title="Lower Body"
    equippedItem={equipment.lower_body}
    pocketContainers={lowerBodyPockets}
    isCollapsed={lowerCollapsed}
    onToggle={() => setLowerCollapsed(!lowerCollapsed)}
  />
  
  {/* Backpack Section */}
  <ClothingContainerPanel 
    title={backpack ? "Backpack" : "Backpack (none)"}
    containerId="backpack-container"
    isCollapsed={backpackCollapsed}
    onToggle={() => setBackpackCollapsed(!backpackCollapsed)}
  />
</div>
Acceptance:

Three-section layout renders correctly
Each section collapses independently
Scroll works across all sections
No functional changes yet (just layout)
Phase 6C: Replace BackpackGrid with UnifiedClothingPanel
Goal: Switch the main inventory panel to use the new unified layout.

Implementation:

In InventoryPanel.tsx, replace <BackpackGrid /> with <UnifiedClothingPanel />
Remove old BackpackGrid.tsx import
Update any tests or references
Acceptance:

Backpack still works in new location
Upper/Lower body sections appear (empty for now)
All collapse toggles work
Scrolling works correctly
Phase 6D: Wire Upper/Lower Body Pocket Display (Read-Only)
Goal: Display pocket grids when upper/lower body items are equipped (no interaction yet).

Implementation:

In ClothingContainerPanel, detect if equipped item has pockets:
const pocketContainers = item?.isContainer() 
  ? item.getPocketContainers() 
  : [];
Render each pocket grid using ContainerGrid:
{pocketContainers.map((pocket, idx) => (
  <ContainerGrid
    key={pocket.id}
    containerId={pocket.id}
    width={pocket.width}
    height={pocket.height}
    enableScroll={false}
  />
))}
Show "(none)" suffix when no item equipped
Acceptance:

Equipping upper body item via console shows its pocket grids
Equipping lower body item via console shows its pocket grids
Unequipping hides the grids
Each pocket appears as separate grid
No drag/drop yet (Phase 5G handles that)
Phase 6E: Clean Up InventoryExtensionWindow
Goal: Remove pocket displays from extension window since they're now in main panel.

Implementation:

Keep equipment slots in InventoryExtensionWindow.tsx
Remove the pocket grid sections (body-pocket-1 through legs-pocket-4)
Keep only crafting panel in extension window
Simplify layout to just show equipment slots + crafting
Acceptance:

Extension window shows only equipment slots and crafting
No duplicate pocket grids
Cleaner, more focused extension panel
Main inventory panel is the authoritative view for all containers
Phase 6F: Equipment Interaction Integration
Goal: Ensure Phase 5H equipment selection works with new layout.

Implementation:

Verify left-click selection on equipment slots still works
Ensure clicking grid cells with selected equipment item unequips correctly
Test that pocket grids participate in drag/drop from Phase 5G
Verify all container grids use same slot size from GridSizeContext
Acceptance:

Can select equipped upper/lower body items
Can unequip by clicking grid cell
Can drag items between pockets, backpack, and ground
All grids use consistent slot sizing
Summary of Changes
New Files:

ClothingContainerPanel.tsx - Reusable collapsible container component
Modified Files:

UnifiedClothingPanel.tsx - New 3-section layout (replaces BackpackGrid functionality)
InventoryPanel.tsx - Uses UnifiedClothingPanel instead of BackpackGrid
InventoryExtensionWindow.tsx - Simplified to equipment slots + crafting only
Removed Files:

BackpackGrid.tsx - Replaced by UnifiedClothingPanel
Visual Result:

┌─────────────────────────────────┐
│ UPPER BODY          [▼]         │  ← Collapsible
│ ┌───┬───┐ ┌───┬───┐            │
│ │   │   │ │   │   │  (pockets) │
│ └───┴───┘ └───┴───┘            │
├─────────────────────────────────┤
│ LOWER BODY          [▼]         │  ← Collapsible
│ ┌───┬───┐ ┌───┬───┐            │
│ │   │   │ │   │   │  (pockets) │
│ └───┴───┘ └───┴───┘            │
├─────────────────────────────────┤
│ BACKPACK            [▼]         │  ← Collapsible
│ ┌─────────────────┐            │
│ │                 │            │
│ │   (6x10 grid)   │            │
│ │                 │            │
│ └─────────────────┘            │
└─────────────────────────────────┘
     ↕ Scroll when needed
This plan maintains your existing Phase 5 work (equipment selection, drag/drop) while reorganizing the layout to be more cohesive and user-friendly. Each phase is small, testable, and builds on the previous one.